# 修复版 Dolphin SLAM 配置文件
# 统一话题命名，确保节点间正确通信

robot_state_node:
  ros__parameters:
    navigation_csv: "/media/psf/Samsung T7/SLAM Data/Sunboat_03-09-2023/2023-09-03-07-58-37/navigation/navigation.csv"
    base_frame: "base_link"
    odom_frame: "odom"
    map_frame: "map"
    publish_rate: 20.0
    publish_tf: true

image_processing_node:
  ros__parameters:
    feature_type: "SIFT"
    max_features: 200                                # 减少特征数量，提高处理速度
    process_every_n_frames: 1                        # 处理每一帧（水下变化慢）
    enable_visualization: true
    camera_topic: "/camera/image_raw"
    sonar_topic: "/sonar/image_raw"
    descriptors_topic: "/features/descriptors"
    keypoints_topic: "/features/keypoints"
    
    # SIFT参数优化（水下环境）
    sift_n_features: 200
    sift_contrastThreshold: 0.03                     # 降低对比度阈值（水下对比度低）
    sift_edgeThreshold: 20                           # 增加边缘阈值（更宽松）
    sift_sigma: 1.2

# 同时优化local_view_node参数
local_view_node:
  ros__parameters:
    matching_algorithm: "temporal_feature_matching"
    similarity_threshold: 0.5                  # 🔧 降低阈值 (0.6→0.5)
    max_templates: 25                          # 🔧 增加模板数 (20→25)
    enable_debug: false
    debug_level: 0
    min_match_count: 12                        # 🔧 降低匹配数 (15→12)
    match_ratio_threshold: 0.75                # 🔧 提高比例阈值 (0.7→0.75)
    temporal_weight_factor: 3.0                # 🔧 降低时间权重 (5.0→3.0)
    recent_template_priority: 8                # 🔧 增加优先检查数 (5→8)
    descriptors_topic: "/features/descriptors"
    matches_topic: "/local_view/matches"
    enable_underwater_report: false
    
    # 🔧 平衡的水下环境参数
    underwater_mode: true
    frame_skip_threshold: 0.9                  # 🔧 降低跳过阈值 (0.8→0.9)
    max_matches_per_second: 20                 # 🔧 增加匹配限制 (10→20)
    min_template_age: 2.0                      # 🔧 降低模板年龄 (3.0→2.0)
    significant_change_threshold: 0.08         # 🔧 降低显著变化阈值 (0.15→0.08)
    temporal_smoothing_window: 3               # 🔧 减少平滑窗口 (5→3)
    
# 优化的CAN和视觉参数配置
place_cell_node:
  ros__parameters:
    # 基础参数
    visual_similarity_threshold: 0.7
    enable_visual_debug: false
    neurons_per_dimension: 16
    update_rate: 20.0
    major_report_interval: 300
    spatial_scale: 30.0
    enable_path_integration: true
    odometry_topic: "/dolphin_slam/odometry"
    visual_match_topic: "/local_view/matches"
    activity_topic: "/place_cells/activity"
    
    # 平衡的CAN参数
    excitation_radius: 1.0
    inhibition_strength: 0.5
    activity_threshold: 0.15
    normalization_factor: 5.0
    visual_update_cooldown: 1.0
    min_visual_change_threshold: 0.1
    
    # 抑制参数
    global_inhibition_factor: 0.5
    winner_take_all_strength: 0.3
    lateral_inhibition_radius: 1.0
    decay_rate: 0.08
    
    # 输入强度参数
    position_input_strength: 12.0
    visual_input_strength: 1.0
    
    # 🔧 调试增强参数
    movement_threshold: 0.01                    # 🔧 大幅降低移动检测阈值
    enable_position_debug: true                 # 🔧 启用位置调试
    position_input_override: 80.0                # 🔧 位置输入覆盖强度
    center_tracking_strength: 3.0               # 🔧 中心跟踪强度
    
experience_map_node:
  ros__parameters:
    odometry_topic: "/dolphin_slam/odometry"    # 修正：统一使用dolphin_slam命名空间
    place_cell_topic: "/place_cells/activity"
    visual_match_topic: "/local_view/matches"
    match_threshold: 0.75
    


